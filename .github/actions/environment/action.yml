name: 'Download dependencies'
description: 'Nixpkgs and uv'
inputs:
  full-deps:
    description: 'Pass --arg fullDeps true to nix-shell?'
    required: false
    default: false
runs:
  using: "composite"
  steps:
    - name: Install nix
      uses: cachix/install-nix-action@v31
      with:
        nix_path: nixpkgs=channel:nixos-unstable
    - name: strace
      run: sudo apt install strace
      shell: sh
    - name: Dependencies nixpkgs
      run: strace -o strace.log -t -f timeout -v --kill-after=10 600 nix-shell --arg fullDeps "${{ inputs.full-deps }}" --run "true"
      shell: sh
    - name: strace logs
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: strace-${{ github.job }}${{ strategy.job-index }}
        path: |
          strace.log
          retention-days: 1
