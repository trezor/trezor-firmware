name: 'Download dependencies'
description: 'Nixpkgs and uv'
inputs:
  full-deps:
    description: 'Pass --arg fullDeps true to nix-shell?'
    required: false
    default: false
runs:
  using: "composite"
  steps:
    - name: Install nix
      uses: cachix/install-nix-action@v31.1.0
      with:
        nix_path: nixpkgs=channel:nixos-unstable
    - name: strace
      run: sudo apt install strace
      shell: sh
    - name: Dependencies nixpkgs
      run: timeout -v --kill-after=10 600 nix-shell --arg fullDeps "${{ inputs.full-deps }}" --run "nixpkgs success"
      shell: sh
    - name: Dependencies nixpkgs
      run: timeout -v --kill-after=10 600 nix-shell --arg fullDeps "${{ inputs.full-deps }}" --run "worked for the 2nd time"
      shell: sh
      if: failure()
