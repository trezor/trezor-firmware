from common import *
from trezor.messages import TxInput, SignTx, PrevOutput
from trezor.enums import InputScriptType
from apps.zcash.hasher import ZcashHasher
from apps.bitcoin.common import SigHashType
from apps.common.coininfo import by_name
from apps.zcash.orchard.crypto.builder import Action
from apps.zcash.orchard.crypto.note_encryption import TransmittedNoteCiphertext


ZCASH_COININFO = by_name("Zcash")

null = None
ZCASH_TEST_VECTORS = [
    ["From https://github.com/zcash-hackworks/zcash-test-vectors/blob/master/zip_0244.py"],
    ["tx, txid, auth_digest, amounts, script_pubkeys, transparent_input, sighash_shielded, sighash_all, sighash_none, sighash_single, sighash_all_anyone, sighash_none_anyone, sighash_single_anyone"],
    ["050000800a27a726b4d0d6c27a8f739a2d6f2c0201e152a8049e294c4d6e66b164939daffa2ef6ee6921481cdd86b3cc4318d9614fc820905d0453516aaca3f2498800019f33bf3a109bdd1b232b47b1646d91e1296634ebde5ccad57288b5b2228186e54b6968912a6381ce3dc166d56a1d62f5a8d7551db5fd9313e8c7203d996af7d41a38e01d94903d3c3e0ad3360c1d3710acd20b183e31d49f25c9a138f49b1a5301466b3da612149df5eda0f14f2efc5c6ac03884428a315dc91f8d7b492ebc57e475a4a6f26572504b192232ecb9f0c02411e52596bc5e90457e745939ffedbd121e37ec1e9dddc31b06dc9576a1738ef73e6ba71648913dbf75a779fdd488d83f857deecc40a98d5f2935395ee4762dd21afdbb5d47fa9a6dd984d567db2857b927b7fae2db587105415d4642789d38f50b8dbcc129cab3d17d19f3355bcf73cecb8cb8a5da01307152f13936a270572670dc82d39026c6cb4cd4b0f7f5aa2a4f5a5341ec5dd715406f2fdd2afa733f5f641c8c21862a1bafce2609d9eecfa158cfb5cd79f88008e315dc7d8388e76c1782fd2795d18a763624c25fa959cc97489ce75745824b77868c53239cfbdf73caec65604037314faaceb56218c6bd30f8374ac13386793f21a9fb80ad03bc0cda4a44946c00e1b1a1df0e5b87b5bece477a709649e950060591394812951e1fe3895b8cc3d14d2cf6556df6ed4b4ddd3d9a69f53357d7767f4f5ccbdbc596631277f8fecd08cb056b95e3025b9792fff7f244fc716269b926d62e9596fa825c6bf21aff9e68625a192440ea06828123d97884806f15fa08da52754a1095e3ff1abd5ce4fddfccfc3a6128aef784a64610a89d1a7099216d0814d3a2d452431c32d411ac1cce82ad0229407bbc48985675e3f874a4533f1d63a84dfa3e0f460fe2f57e34fbc75423c3737f5b2a0615f5722db041a3ef66fa483afd3c2e19e59444a64add6df1d963f5dd5b5010d3d025f0287c4cf19c75f33d51ddddba5d657b43ee8da645443814cc7329f3e9b4e54c236c29af3923101756d9fa4bd0f7d2ddaacb6b0f86a2658e0a07a05ac5b950051cd24c47a88d13d659ba2a46ca1830816d09cd7646f76f716abec5de07fe9b523410806ea6f288f8736c23357c85f45791e1708029d9824d90704607f387a03e49bf9836574431345a7877efaa8a08e73081ef8d62cb780ab6883a50a0d470190dfba10a857f82842d3825b3d6da0573d316eb160dc0b716c48fbd467f75b780149ae8808f4e68f50c0536acddf6f1aeab016b6bc1a51ed44cfab70000c7b3534201cfb1cd8dbf69b8250c18ef41294ca97993db546c1fe01f7e9c8e367edcf04be34a9851a7af9db6990ed83dd64af3597c04323ea51b0052ad8084a8b9da948d320dadd64f5431e61ddf658d24ae67c22c8d1309131fc00fe7f235734276d38d47f1e191e00c7a1d48af046827591e9733a97fa6b679f3dc601d008285edcbdae69ce8fc1be4aac00ff2711ebd931de518856878f73476f21a482ec9378365c8f7393c94e2885315eb4671098b79535e790fe53e29fef2b3766697ac32b4f473f468a008e72389fc03880d780cb07fcfaabe3f1a84b27db59a4a153d1070689f2ccf975b2b176e1c69dbe381340ef1f98fdc4b453abda3a2bfac3069ba7f1cc50a81c2520e412fab4e5d397ecf739f280d5b684533d5d29cfe7e7302ec144b4e553acfd670f77e755fc88e0677e31ba459b44e307768958fe3789d41c2b1ff434cb30e15914f01bc6bc2307b488d2556d7b7380ea4ffd712f6b02fe806b94569cd4059f396bf29b99d0a40e5e1711ca944f72d436a102fca4b97693da0b086fe9d2e7162470d02e0f05d4bec9512bfb3f38327296efaa74328b118c27402c70c3a90b49ad4bbc68e37c0aa7d9b3fe17799d73b841e751713a02943905aae0803fd69442eb7681ec2a05600054e92eed555028f21b6a155268a2dd664052528a5f8ed028f59af985ad1315c2e25aeb9d7f134e4bf478642ab96b15d3b3e13ce2387ac84dc0819e81260e11d392a5f06db8b5633de281a0e9c958c24060297f608af1dc51616562b1ffff6e2a28bab1f7772713a0a4b56fe47fb5a7b73aeee5345566ecf3e95e825f92eb469eb5d69164206a0ea1ce73bfb2a942e73703214d270d80534389b1a1e2bba67481eb3667d6d38254ac4b44559b4708cdd12898972a895bf0fb055cf1fb9b73029d6bfb27da2b5294f5cb354a894322848cc3d35b9554a5f62b44a7dcb25406e5ba07882cb6473714e77a051a7dcd29fea0a943785b325cdab95404fc7aed70525cddb41872cfcc214b13232edc78609753dbff930eb0dc156612b9cb434bc4b693392deb87c530435312edcedc6a961133338d786c4a3e103f60110a16b1337129704bf4754ff6ba9fbe65951e610620f71cda8fc877625f2c5bb04cbe1228b1e886f4050afd8fe94e97d2e9e85c6bb748c0042d3249abb1342bb0eebf62058bf3de080d94611a3750915b5dc6c0b3899d41222bace760ee9c8818ded599e34c56d7372af1eb86852f2a732104bdb750739de6c2c6e0f9eb7cb17f1942bfc9f4fd6ebb6b4cdd4da2bca26fac4578e9f543405acc7d86ff59158bd0cba3aef6f4a8472d144d99f8b8d1dedaa9077d4f01d4bb27bbe31d88fbefac3dcd4797563a26b1d61fcd9a464ab21ed550fe6fa09695ba0b2f10eea6468cc6e20a66f826e3d14c5006f0563887f5e1289be1b2004caca8d3f34d6e84bf59c1e04619a7c23a996941d889e4622a9b9b1d59d5e319094318cd405ba27b7e2c084762d31453ec4549a4d97729d033460fcf89d6494f2ffd789e98082ea5ce9534b3acd60fe49e37e4f666931677319ed89f85588741b3128901a93bd78e4be0225a9e2692c77c969ed0176bdf9555948cbd5a332d045de6ba6bf4490adfe7444cd467a09075417fcc0062e49f008c51ad4227439c1b4476ccd8e97862dab7be1e8d399c05ef27c6e22ee273e15786e394c8f1be31682a30147963ac8da8d41d804258426a3f70289b8ad19d8de13be4eebe3bd4c8a6f55d6e0c373d456851879f5fbc282db9e134806bff71e11bc33ab75dd6ca067fb73a043b646a7cf39cab4928386786d2f24141ee120fdc34d6764eafc66880ee0204f53cc1167ed20b43a52dea3ca7cff8ef35cd8e6d7c111a68ef44bcd0c1513ad47ca61c659cc5d325b440f6b9f59aff66879bb6688fdb462af43582b983f92b5698b87db46e4b02dd8e81eca555a44f2f1aef11d88a0bcee76af9ad3f9c46a67062e1a9ca7ea5c014384af07219c7c0ee7fc7bfc7933d174650f46b4cc000190c19b44c57ae891aa86646c10a177a8626be064409931c37d9e8bdc433b7d79e08a12f738a8f0dbddfef2f2657ef3e47d1b0fd11e6a13654db2854fcbff49aa0dadafec320b6ed2d4b279aee9060c1b221e2eb2f13b0691c4d842406d0ec4282c9526174a09878fe8fdde33a29604e5e5e7b2a025d6650b97dbb52befb59b1d30a57433b0a351474444099daa371046613260cf3354cfcdada663ece824ffd7e44393886a86165ddddf2b4c41773554c86995269408b11e6737a4c447586f69173446d8e48bf84cbc000a807899973eb93c5e819aad669413f8387933ad1584aa35e43f4ecd1e2d0407c0b1b89920ffdfdb9bea51ac95b557af71b89f903f5d9848f14fcbeb1837570f544d6359eb23faf38a0822da36ce426c4a2fbeffeb0a8a2e297a9d19ba15024590e3329d9fa9261f9938a4032dd34606c9cf9f3dd33e576f05cd1dd6811c6298757d77d9e810abdb226afcaa4346a6560f8932b3181fd355d5d391976183f8d99388839632d6354f666d09d3e5629ea19737388613d38a34fd0f6e50ee5a0cc9677177f50028c141378187bd2819403fc534f80076e9380cb4964d3b6b45819d3b8e9caf54f051852d671bf8c1ffde2d1510756418cb4810936aa57e6965d6fb656a760b7f19adf96c173488552193b147ee58858033dac7cd0eb204c06490bbdedf5f7571acb2ebe76acef3f2a01ee987486dfe6c3f0a5e234c127258f97a28fb5d164a8176be946b8097d0e317287f33bf9c16f9a545409ce29b1f4273725fc0df02a04ebae178b3414fb0a82d50deb09fcf4e6ee9d180ff4f56ff3bc1d3601fc2dc90d814c3256f4967d3a8d64c83fea339c51f5a8e5801fbb97835581b602465dee04b5922c2761b54245bec0c9eef2db97d22b2b3556cc969fbb13d06509765a52b3fac54b93f421bf08e18d52ddd52cc1c8ca8adfaccab7e5cc2f4573fbbf8239bb0b8aedbf8dad16282da5c9125dba1c059d0df8abf621078f02d6c4bc86d40845ac1d59710c45f07d585eb48b32fc0167ba256e73ca3b9311c62d1094903570519d4442f0200e6ad11f2452dc9ae85aec01fc56f8cbfda75a7727b75ebbd6bbffb43b63a3b1b871e40feb0db002974a3c3b1a788567231bf6399ff89236981149d423802d2341a3bedb9ddcbac1fe7b6435e1479c72e7089d029e7fbbaf3cf37e9b9a6b776791e4c5e6fda57e8d5f14c8c35a2d270846b9dbe005cda16af4408f3ab06a916eeeb9c9594b70424a4c1d171295b6763b22f47f80b53ccbb904bd68fd65fbd3fbdea1035e98c21a7dba5fe1089f7d1c032f24d36835aa8815266e897ff829403cfac3a715954b9b68958a0111a2c9265633ba2831a2e86b941e569d58d99c1383597fad81193c4c13151f40aedb487b5c04ae3b1ddfbafa26e720099f26d5a7535aee57306fd2c4f30673cd9b698fecf32faf88f62e21c90665859dd26833d21d9bc5452bd19515d3fa5c1e68bc209b9dc2a10ae6b630726a67b33603c691fafc281dd94dc9888a68c4f45155aa7897c045aafd9335be2e0ddcf5f586d7f6b4fe12dad9a17f5db7031", "552c96bd33834ba1a8a3ecd80a2c9cb41187553a3dcfe7928316bb70704b85d0", "12767e5f678567360fb3a1cb9cf858613ffe2263b653c6a370ee1f6820abdc57", [1800841178198868], ["650051"], 0, "88da64b95b56d8296ab1f721eb5be66d0fd478f2b96b93d5dcee8f7a1000b0ff", "2d4ebf4d424238ad0bc2469970347eaf767ff906958e35107fd22c1dc536e459", "683ecaa564002ca5a80bea04370c78855b8d9c9c382309c70b29bdd98d75b066", null, "9c9e75ee15f4eda15d777939529fa3a4f64b935c7d21835f79393e7aa23e2879", "a7dff00a96fd2b41c5808d35e4a6a2aa7b40eeebb6dcf3b9f281eb6c17e43af4", null],
    ["050000800a27a726b4d0d6c21fc998c31f4dd208010000000000000000000000000000000000000000000000000000000000000000ffffffff06041f4dd20800ffffffff015058e5754c2104000753ac51530051520001e5849f96bae6f2056f33ab1e6989d7d264adc97855a990103b4d1e6350d5c31a39c3caf69459e462f141be8b39037ffa255ce27e4ad7b566a29620a9f011ab08fb2ad3050652b3f65b8e34526a2a15fc2ddc5b5113e4882c7cca0dd5577be067ba7a175dae4bbe3ef4863d53708915090f47a068e227433f9e49d3aa09e356d8d66d0c0121e91a3c4aa3f27fa1b63396e2b41db908fdab8b18cc7304e94e970568f9421c0dbbbaf84598d972b0534f48a5e52670436aaa776ed2482ad703430201e53443c36dcfd34a0cb6637876105e79bf3bd58ec148cb64970e3223a91f71dfcfd5a04b667fbaf3d4b3b908b9828820dfecdd753750b5f9d2216e56c615272f854464c0ca4b1e85aedd038292c4e1a57744ebba010b9ebfbb011bd6f0b78805025d27f3c17746bae116c15d9f471f0f6288a150647b2afe9df7cccf01f5cde5f04680bbfed87f6cf429fb27ad6babe791766611cf5bc20e48bef119259b9b8a0e39c3df28cb9582ea338601cdc481b32fb82adeebb3dade25d1a3df20c37e712506b5d996c49a9f0f30ddcb91fe9004e1e83294a6c9203d94e8dc2cbb449de4155032604e47997016b304fd437d8235045e255a19b743a0a9f2e336b44cae307bb3987bd3e4e777fbb34c0ab8cc3d67466c0a88dd4ccad18a07a8d1068df5b629e5718d0f6df5c957cf71bb00a5178f175caca944e635c5159f738e2402a2d21aa081e10e456afb00b9f62416c8b9c0f7228f510729e0be3f305313d77f7379dc2af24869c6c74ee4471498861d192f0ff0f508285dab6b6a36ccf7d12256cc76b95503720ac672d08268d2cf7773b6ba2a5f664847bf707f2fc10c98f2f006ec22ccb5a8c8b7c40c7c2d49a6639b9f2ce33c25c04bc461e744dfa536b00d94baddf4f4d14044c695a33881477df124f0fcf206a9fb2e65e304cdbf0c4d2390170c130ab849c2f22b5cdd3921640c8cf1976ae1010b0dfd9cb2543e45f99749cc4d61f2e8aabfe98bd905fa39951b33ea769c45ab9531c57209862ad12fd76ba4807e65417b6cd12fa8ec916f013ebb8706a9a556c762f88500006effeda06c4be24b04846392e9d1e6930eae01fa21fbd700583fb598b92c8f4eb8a61aa6235db60f2841cf3a1c6ab54c67066844711d091eb931a1bd6281aedf2a0e8fab18817202a9be06402ed9cc720c16bfe881e4df4255e87afb7fc62f38116bbe03cd8a3cb11a27d568414782f47b1a44c97c680467694bc9709d32916c97e8006cbb07ba0e4180a3738038c374c4cce8f32959afb25f303f5815c4533124acf9d18940e77522ac5dc4b9570aae8f47b7f57fd8767bea1a24ae7bed65b409e1dd26b8dddd68858d6f5161f073d90636860a9aaee18629b06330a8ee30591debfcef56a026bb28c3b06ec2cfaf5b79ab72694d1d012a7594dd80ae7dfa0c00", "a3cbadd7a58d80a4c2f61809c24a2f086c58ceecaf7af9414c38bdbdc4e46e98", "ad64580ed3a28a3ba41e2d320b5ff2a07fa19db074afc455e92e0f326be08a6a", [], [], null, "a3cbadd7a58d80a4c2f61809c24a2f086c58ceecaf7af9414c38bdbdc4e46e98", null, null, null, null, null, null],
    ["050000800a27a726b4d0d6c2c2eb518f68984d02010000000000000000000000000000000000000000000000000000000000000000ffffffff060468984d0200ffffffff00000000", "28d16c3cd78a6b7a50b11a1b8417764c4e63c6e3d8aa289f7e87e39845872764", "332155b1cc23a2571e86e49e06010cd25321dcfcca34ae14e8b3f4f00270d287", [], [], null, "28d16c3cd78a6b7a50b11a1b8417764c4e63c6e3d8aa289f7e87e39845872764", null, null, null, null, null, null],
    ["050000800a27a726b4d0d6c25e3dbaf7ae12670d010000000000000000000000000000000000000000000000000000000000000000ffffffff0604ae12670d00ffffffff01516cf4adec75070003656500000000", "6bf4efe77af69b7219475f60a0f792db0263e4e12fa1d9ee1a1b9a68540590da", "993bfca6149975a4013797ead55839a13a0fb152f68372bb0e0fd9499477f903", [], [], null, "6bf4efe77af69b7219475f60a0f792db0263e4e12fa1d9ee1a1b9a68540590da", null, null, null, null, null, null],
    ["050000800a27a726b4d0d6c2ff6acc0ffc2e490d03146b9d49dd8c7835f43a37dca0787e3ec9f6605223d5ba7ae0ab9025b73bc03f7fac36c009636363635100635365bca7e54cc1a12d127b57c8138976e791013b015f06a624f521b6ee04ec980893c7e5e01a3362035904ac000053d7445fe2d09130f63511da54832de9136b39f4599f5aa5dfbb45da60cdceab7eefde89be63f3f7c00452006aace1405def0244fd7f99b67d040004630063ac12f6465073e1020009636a5351520065ac65000000", "bc34e5ca581c5c6544aafb3e5865348f71b8aa2a782df8b6bfa1791bf5a73758", "6c36bc25fc4856e5098e5d33033c5b3875217fcb45526118bb058a2dd7b6ea5e", [1848924248978091, 447389782351145, 620151782842275], ["ac0000", "6565", ""], 0, "a960f4baa5f4331f4dadc374566bc047e7c07153b0385a587a2be86a518ab5d3", "8f607656c52d9ad2231120c24faa7b6855ae571bee46e61d76a25cffb2bb4fcb", "fdcf8a04690dc2769d934337fe8b47242a6ed7c9d86d3e01332484d38d71e785", "b3a28ebd7cf37a443a40909f513f081fbe0fd78c67f7c4f01b5fb1159789861a", "62eada92bbc5af09ab7b95834ae6ba413b17cdf196a6f99c541b710ddacfa545", "dff0eb1e03b9c2fe301db9b0183583618893c8474ef565921d5f2832ede3bf49", "1de607f188a40b5c152226d94e44411b6902947d42fbb25fb86c9a4e77a4f35b"],
    ["050000800a27a726b4d0d6c223e119f635ef1d05024b216b7023fadc2d25949c90037e71e3e550726d210a2c688342e52440635e9cc14afe100665515151ac53782e9e4a5fa87f0a956f5b85509960285c22627c59483a5a4c28cce4b156e551406a7ee8355656a20043e38ce103bd9a274e288d020000aafe033252c7030005516a63656338eb8b41ca5104000653516365acac000000", "90d2886cb628813371c7d1bd02031b6ca66b42d1db4e118d65f31b2dccb63235", "9c0532e6788fe9e28b3b67f571989be77ae761dfd375c74bbf5db3cafaa1f9a5", [1561051182746413, 1535468271734483], ["656a516aac516a6552", "52"], 1, "24a91d017e691fe7d580e3fc16872d612c14bfcbe5e2725e16d09ec0c1c91305", "2bea7c00cf77fa59a63ab0bd3eb7b10659f8fc9e4c4894bafc37640e8655f562", "e63603eade7dde98ef0ed68de640707df6cc9c337837bcbdcde05a07ff7d873b", "e4b2f98ad7b55fb256a12923303abcaeee38351090e976b0195dd75bdcf94ad9", "61c705d5505f0d5cfb3a28519d791f1457704f7b38392eff885a8207fa683c57", "f35ea9beb0b7ed682d27ef78dde1178d6a55f307c85121cd830258d89d33cdd1", "aece3f45769876d87b50478b90cd5e3b37b7f4c55b38f756a57486a31061dfa8"],
    ["050000800a27a726b4d0d6c24723622987d8d704000002aca3c4c6433b1da60595c2bafc722b38e7910f63616b22c9d677b17979566db2149b1d99341e4e6f9120f4d41e629185002c72c012c414d2382a6d47c7b3deab591efff360fe1199056c56e5feec61a7b8b9f699d6012c2849232f329fef95c7d181172c284ce8a4b322961ad781a5b9736d7f12e8643453c105a79a9f5ae009fa1ae6c25a9462ebcbb0fd5f14554bc97747c33e34da90c816d8d0d50bfe37618c5812891484fa259322c15092d4155d8696d6f12f24fd364496b3be0871ca3d02d2b6bcd59ead5e27e83ef2d4408754e9003161877669e1a4d850bf9fc1c231854d037e262f9a9f9bd8904467eaead83f0938e26e345f9cc695985f00a1255a0a4f95db9dadcdb7c240899aea2783c2d21c2d3279f886f7ab3d4e8af5381fa0b01848f1ab14ad334f2b68035808cdf1bb9e9d9a816baf728a955b960b7701fa626687dc3c9cba646337b53e29816e9482ddf5578a8768aae477fce410ac2d5de6095861c111d7feb3e6bb4fbb5a54955495972798350a253f05f66c2ecfcbc0ed43f5ec2e6d8dba15a51254d97b1821107c07dd9a16ef8406f943e282b95d4b362530c913d6ba421df6027de5af1e4745d5868106954be6c1962780a2941072e95131b1679df0637625042c37d48ffb152e5ebc185c8a2b7d4385f1c95af937df78dfd8757fab434968b0b57c66574468f160b447ac8221e5060676a842a1c6b7172dd3340f764070ab1fe091c5c74c95a5dc043390723a4c127da14cdde1dc2675a62340b3e6afd0522a31de26e7d1ec3a9c8a091ffdc75b7ecfdc7c12995a5e37ce3488bd29f8629d68f696492448dd526697476dc061346ebe3f677217ff9c60efce943af28dfd3f9e59692598a6047c23c4c01400f1ab5730eac0ae8d5843d5051c376240172af218d7a1ecfe65b4f75100638983c14de4974755dade8018c9b8f4543fb095961513e67c61dbc59c607f9b51f8d09bdcad28bcfb9e5d2744ea8848b2623ac07f8ef61a81a35910b8a1baf39a919a7b60bc604d63185f759221d847cc54a22765a4c33475b5791e9af3271fc8d9350667090d8184ec50522d804f23c4fb44ffa481bc92ae408d1b9f2b131904f9705c59e2f4bde7a3b2c085d93fd2abc5e14d163001a12f51938d021afa92239b873dc6c357eaa8af4ee6d00540657fe32914103b5d98f68bd3e2b5359f08ccd88d0c811e4c31fbb49f3a90bbd05dce62f344e7077593159ae35050b04c9e6b86bc432dc8b048c73c0018ca5b69411297732a4e1aa99a928c71e7a24fd277856aa42501e51b012aea9446a2104e93f815a0b3a29b458314f3d8be2b9823d3421505ff6d8890e904a24a7de951a2a1c64ed2e4f9e9a5165eba4799cefeb5d148005545f9b5fb0eec6503febbdd26a238514383734afec8a481cfb2fe1ff92f1ea78407b407c6b84a214ef607cc5904d9e8c73febffa01c2b1779dc420f089eade20b69d5d7c43ceb736b6831e8c110f16cfdb3a467e9414c00ecf13731500894555678c497faba9a95d01cc464390fc4a76bfa8b0e1c68a525d706d6604b2330b6b3485215f606f1883a751588c7efa506c3e8d0c60192e8476bd1175d9562087bdb818e66216286bafe47ff4dbcced51444480a9a5673ece7fac73a0ed41ab0051753a7caa89be3139afd9793b3e02f27f040046595acd47bf13fd0da27f09eda48036d3ee437f2ee8f8606ea97343c33584657f46dba99db5cfe6ca176fab7b0f3bfa0ab61e340c34eb9f17c7ec2be03b180f0bb6f434c2a6542e00e84373f4f4649cda32bf686666143f622aa480460b5afac518607cd9af8bcd6b58c30127316b25d5ea7bf6b0cab8542ff69d9b2f180be12ed75344a395aa10f852f083ad64ef40e9c0309e9bba54b8cb33c95498a69538d3ae5b25e247098306fa8c74a8ee5bca941531d61aac27aab3dc5617d5606c9577a2a8346e8d85b32b8505775108dc85e2ade2eac1e636e1af4054c8b6f57632df269c3723b320872e4c57b218358dc7e9905bb04edf92edf0df635f3bf361e57a13296e1447af5087872d636e27518a9876e15eb01f5e8ded81892511cc2851b00b832712a6d3ba5666517bcd3567621a7cf8445589653262020c33bf78031b8ee0707de072068c170570327e6d9f5c6ddc335402efc548862f5a07094fd428a7bbc15d7b38d05362c9ca985f58a76647d2be4c2cd6b3d17d6870971d7a098baf72c6f6f1214cf1faae488bd7de259d3415c2f0ddec7457004f35708d1eccccc0df65a04943ad5cbc13f295f000fe056c40b2d88f27dc34cfeb803be3483a9ebf9b5a9026057725d63ead2c0c0ff1fe26ac1e7bdfcd6fad875842d194f331750462c06b8d7982d67995ed5d3ae96a05ae0067f4eb1c7c93231bd39773cbe0a9d33a0a40b101d020077d97ce424013d64b4d0d272ec01946b7a5eedfab4d68cd6d1b2667d04b29d0caf370098ffe4918e0ca1df47f275867b739e0a514d3209325e217045927b479c1ce2e5d54f25488cad1513e3f44a21266cfd841633327dee6cf810fbf7393e317d9e53d1be1d5ae7839b66b943b9ed18f2c530e975422332c3439cce49a29f2a336a4851263c5e9bd13d731109e844b7f8c392a5c1dcaa2ae5f50ff63fab9765e016702c35a67cd7364d3fab552fb349e35c15c50250453fd18f7b855992632e2c76c0fbf1ef963ea80e3223de3277bc559251725829ec03f213ba8955cab282d9625348a614b59bde45885649bae36de34def8fcec85343475d976ae1e9b27829ce2ac5efd0b399a8b448be6504294ee6b3c1c6a5342d7c01ae9d8ad3070c2b1a91573af5e0c5e4cbbf4acdc6b54c9272200d9970250c17c1036f06085c41858ed3a0c48150bc697e4a695fef335f7ad07e1a46dc767ff822db70e6669080b9816b2232c81a4c66cc586abfe1eaa8ca6cf41fc3c3e6c7b886fb6dac9f4822b4fc6fff9d0513d61a21c80a377671d135a668a0ae2bb934c82c4142da69d12ca724756a379a69f83e70cee0c78cf313a777fab48ee203e14fed624162e9cf3865245cfb31ea07ee889e470fee46a06230f70051f11e798c720d37f227ca01b109a1cee92ad5f6b0201ae71eab446999cdcbc4a5fc3b1af13894ae93ddffe8ee1850136b30cda1d83d8d3bea7b131c06141cc2a85fa5b43d05ec954e11b6f37b03f46213e942a7e19a46e970b5c506708430317b1bb3b35df68ae33a4926a03e6bfeb5510416fcbb0524c9ca5074156cc5a5d6fe1c995edc60a2f550411aa41e3da3bdcf64bcf04a0510571b936d47e55cec0330ee8dfe73563404f047d7f3a8a3d7743bc554955210f1eb0d08599ea77d5f974d87176d37d98b9c0ad440407209ed6a9f08464d565593e1a63b938536b49244e97d880173b640f2ddb74d068ecb46cf289b7d891307bba37054cf91b31fc82f74d5fcc000942ede911825f53fe666b0c9aa8cff6a376e1f372eac6ac4e46cc0942245d4c2dcf02d7640ffcc5a6ac3a87f5c411551bcc2f26cb94961d53f95ddb19ae930c8d70f031b29a5df99ff36695e802cbcb6b58c1ba7ed5eacfa76414a41ad4a44f71f1b580d34c3a952920b254a145fea517f5b42b2f65ecd0f82595478d80ae5c8ceea12a161ccbb5eac09990fc619a46080436dbd08d74784af002d58e06faf7f3ceae7d3419b1fca265a5559cf9e2d3b60978d81a678b9ed8e4486b4d14609d6c127c0c2fbffe30a605198367017df5c2b2c020b405035feb4b2cdfe3a281bdbd968e0a90fa651361a42de272cb8c2f54e96f51df91ef119cc7ab7e136a3bdb818b4d78c8e986670030274392265433281c8a771171c2b70a07272d2fbaabf813bf2cc8c2b2bc256d49827ffa8f6b096b4c3a792c5de003f4c33b7216056d9edb7482fb98aa033b65e1199f5837e81ed2fe494a719ffc653fd2bb9ef91327ac210482a6ded0ab8e1c80988bb4585851dc93eccc62322924cd13b5dd4eed66ed8d9972d772629ea64742ee83c04112f09ae574827aa4beb0038f2555a8ba36a9bfba028d7c21ea3cd0bbaa9ae4811c6af06fe80a8c02ab7a00e18e4a6aa1ea1b76945d2615d43ac118b56c2f2960fe93a025f13ec91ffc6d2c353699abb092dedc065db8fa214dbc46466f897b88c58b30152133aa3831af37c74d99e9e36ff7011d3238305691508a2c3a43e755dc081b511d6482a7db65fa9699ea87ff47099ed3637dbb0a3d0ef79796a8ef1e4d94d42b4bc2b4a038ae6e46b24cfc84153d31eaf895063a5ca959be63f37f2ba0d432366736d8632fce072b6ae5b6f3fd59d3faff638275a992fefc87e60d44c2cadc2b5c494e3e72eb4597c96b40167799a9001a2ed3676a8b403ae25ffd772f7081e9a32bcc1c5e2edd4e2a6576b783cce3aae11fa432262548856183ee682d5dc31beb38f061cbdeca7021a444e2dd417df26dcd220f2b731772b439e96d614e1facb486c7a7d5171b1de359f6ad3a96f649c969102a1964fb4b4a1a4279c68e6c372e42187d754e804a61653092069fb9b6d25266890808b015df28c801065da6febdc1a56bfd002625acfaa5373fde149c1cfc3649b4869696d44ecb12479c5ebef995f10029f8b530eeb3fdc2e50e8757fc0bb9e263023db82f878d9ac7ffb0bd4391df1d879899a3ef57bfd0d1f7755648edd85bb052a6edf71cd2628c987429f36dc505ccc43f30e7a869c9e255e2af9fcf30c121796d190000960cb6fe2f1bf246118b498f3247f9d484c73cf09393039e45326b8ffffb3e7e6159c46699f100792d4672950348a90552e45943beeacf03f3216f94e274d63d637d9f190e8a266cdeef153530bee5cb8355260505c2c2e5d990fffdc34ec0ff7f1af81b24ced0efa6213da6c7c60c487f5f7b03f8160a057f46d05bf8218b3add9c06893bd02db9b61191dfb133bfabe4858e47a4cc32e416ec08b8ac7915a43733f4406e9d967c560f344d7e904a28045d91e50d79e42867c0ad0ffb55f68875e586420108a1b092576415dc13693a1212b0e7003084ef95a27a7d4284d276111d860142cb740c15b7b623cf48b3f7bfe3af08df8d1d3e11ff198214e673776f04f0c4e846c32a10c0d559e4968b4f8e1b96cdc1ea7ea31dd86d680e25985e1d5d02580d04274234af2a51b56bb68a29e03bab7b50f306ef5d9a4f8135d69614ab34158fba370f78763d4020081fe39cc231630e4c08915e631771550e9ce1fca2c63fe06b7989d584fa7d782a88c1e7d64b6fbf55e3596af9bcb7585f8c7d3aa5c2082b265249df05701dab031c4bac1ea267a2996a2028d1e6a0f80a3847c531dba96ee65a24189bd2712e40e959664981e58b2a4f951ef8f497dfff2f2f271eab89c628e18b5fcb43882537eaf6ad2a6b1754633caa86bf2c76f3993154fc73e6fbba2210c2743f530a427849a301e00e01129f03a4607f87cbe0762c0b1c65855deba8422ca4b88abeea6a4382cf16ccd6dc7c37c44e549c4534819acd8bb0a02a5fa7a1c1d3806fbc3407fd7da93fd0de6400d3ab8977485cddfbed5932f507b79947adb2fad37615aa717db5f298099f20f263b359a1151a6b75c01365eb154ae42140d6e10342f14f34dc33e07ff0e4d1a6be375b32f84b92e5d81ebb639c4f27e715aa42cc75707d4ebd1bbfbe8f90fc7c953e7a9715e65af8267373d3451674ff084efd92ccf3bcc7aca1467b6327e4f9522b2cc579a7a8fff7ca7cf145dfc13eafc34153b2c3e8afbe53444d0c73b3bd5bc870b01cd457911e356313fd1dafb4c8151634a01aff7cf116d433c3d2b3adda9cebe18f7d172443e5e7b5ac9abe8db2256d7ebe2ff28020939503870597b9a955892c7389650a2d42ec92be723fedf2f2ede5a472aa1e74f33ad41901544edbbe3ac464cf439196015f4f22ac2b8fc01496beab4d45907f479812a259431a2cbc93d4f3b84e4dd366020273a6752e501af6ff1b78ddc817e6ea351d6006becf8d2ffb03990f67774a81e05b7f4bbad8577fa27c9de64e1b11dcf384f5956443748755a9fc6f2a00b10c3657ebac03bfc0b587bef2f45ec8acdaa51c143b0cb25b9142c61bd790a80d7c23f90cc03495b51e4d2843e557f9e2545108c6c6fae359f645c276891c0dcab3faf187700c00310a4fef5631400009a2dbd0e138d2deae41caea5f186577a77d1b737fe21f0fa5a18ebb52755b526ef6130fb56944cfab87527c250d113b29bcac9aaa10c2e7de415edb0806c6da03020a134ca7ecdc8da1bd57a37f55a46940b45b241b1c16ee100927d1bd860d445a9de50d4c384d6e1d00108026c0ea5ebbf0b72fbf5c370bce18d3acbc46599099baae1d802f77333494a7ae130fe86e8f818f9261a2dadb4125229ba0ffc0e7090324430b521a90d224ab7a1024e1d893e7404fedb348e4d5e2235c59a7876a0fc60145c6a009687684460271ee133a437fe52fb6cfba97fcec161df515dde905a24da6d37bdc34044a955e682b47471ca1e8c78c51ed377cd4afa894bd9bd12e707156da0726f7cf5729fabe37216221507c5506ef59ece2a581c9d8b0b2074ab0e848ca6b7054d1841837e8791bd82715a28ab569a9a287a4f6490086b1c22169521cdc132212939c84a10896422170234cd82055a8c1c2e53a0e214938a97ed7cc8de0f4ed4b21b945b55e9eb0559ea858d43fc3113165ea18b7b893a5e326a5b0af475e27a54b207b41f92e33699060cb6704ab5690db57aa812cb9c24430644c3b3b2a44f2718a7df88abc4117b587deff78de9c73af28080b2fd05003e11d3e1b3299dc9521f8b513badb010", "3f1b9faa405d8270e2d9538e339f919793841691ab033d1830a8dcbeed4afc4d", "c90c059feb7c807a6b34777c14a6c028b092d82cd5855ed5fe8defae87d289f7", [], [], null, "3f1b9faa405d8270e2d9538e339f919793841691ab033d1830a8dcbeed4afc4d", null, null, null, null, null, null],
    ["050000800a27a726b4d0d6c21bfeb91b0b31691c03c2e825a597b8fb75bc562d654d62104640dd74e56cd14baaba565b84b845e163d1caef250153981637204f96a59c8e8024d9041b2029e94c15245f1a958840ba3f380a4d20f1184e77827de3ff8f0153459afe241f723c084823230e003d3d21e53501ec0499b083a7dad685c57127f4de64733a880c2db20752535163525263f664a35100000003f927b9469e18229d02c33dec3f117c5d2a8a85db9b5756dd52b8190db2596280fa21394377a4551c76d1f75ac03c262054dffd79a9ded05e888958199eea4501ccfa4152d445a6b308549efc1d9b2b97d39da90c6388be8052458325bfd2f5bf73741d5785837a6b844b474775718c29dd99084e9f88ef153a8329f532a690171c2d1e3074dfae3e23db3948a453c39481a9914dd0ac79e927360129be3a7f119544122000610bd2aacbd82325a59b95154ecd82c88d23abd1e20770ffb8aabf83fc0734964ccd411d1c935714e24aab566f4f08424014c4eca91b590f082b473f361c87415d37bd20d70fd0b52b6ddf1865f766702e32b05b3cf1630ee8597aae19633f3516a8555ac5be32c675be1817efbffd9369041a089c283f19649968c2498cde56f500434f280d77a9c62e43cbd3f136a4c6a00a43e6ed530cb2e8ae838860adc88aacc7bd6a00ae0c19ff4533a485efde082b5f4d1f7a8ebe7ed82b7b05a8cfe1e373459f1bdcbf9525747e8c9508a555facb798740e0bdf994d9739bbe5538a0ae0f076c582c0f5ba878b99b8249db1d7e95056c98af083d98cb0ed9e3f7436e1c7643766f966b83e999206ebd1393b9b2a7f414480fa017480069f85c7749c435ae2fba2ddc1038d547d84854817ef39635c29827aad86726c9ade3b265b9086c8b5b75ef56fe4bd8b4d62893895b3fd2734fdac464156d7e5ebc7ecf1d83b86f659637e3b142c164963b8cdcf4ba4f4035dffc5a789458847781918ac72fc18bbbf5110032e66d75b3171ef4b513290164a77b42b0a4cfb89639ab23845e1aa2a452f3731c8cb65082a622a7c2e0013ea47d0bdd42d6990466649a905c684c3251716d61f760d53de6e3f790fba7f5f1f4de267113bdfcd7422822330b32d58e6777765f22a4116344eeb65b2ec516393ab3751b5356d2b0c9500c0f3e469181035bc3660f0b8f9fbe6e40b5e89cb79b063714ca75e72e2e100a10d63bf784df0820ef25f8ef40fe5f05fb95683f9105ff3cb2d219ab76605a064f69219f1dc0d00b3b48642f970dc00cca4b8b43308be18286ec5a4288d600a3785cb622d468a4c6969b3792f2485027d0ad9aa4a9c2cc972f9ee5190a95b1eb058dddd8c08e7d753f5e011b2bcfee1d52c1c4f20aa3f712741fc093a1b36af555f74e30f85d5cc959307f7435f7ef04ca2c3125bcef2a990176ae339325d5a588da5796faae5bab7c82977c0ff797093e2c1f3a7782a6d39a61ee5528990d8d369e8edcfe38bb702dff02da3428545d9d6157a51e55ebca6a8506e3699a3d7085a4d9fed5094c68b375e984f68393300871e308fcf74e276b62266a8f4ee3945f094d17a7c07cfe0bfd4895a14fac971c92a195b442683c4956bbb195a4fa66dc9cd542c76b9150c84bf890789942f55c200b773ecdd7992cff3eca24de3e0984e10e68ae387534b96cde3792f135bf5f68787d370ca8c4c4074dc5d601ae90495437c3c2d48a3d966683ac05160b7a84eaa7aab74009e57a85f7bf68a2e482000f829c545073a15d5cd0fcc57439a4350eaf098dfb82a085ea8a4af6fa8381f0658819eab483f65b325d5aeda15232cfadec75ab1866e4c0155a9c74a7a57ccf34c483ac7da1588a1b6b9941f11040f94cf78fad89bf11fed69aa0d83105adacdd4e5f04a62424023c9b9e33c4fb7f12bdf21f07f265c537d51c6551f4617b915d21991839c3d0d36393d646e0a8a41509217d0e7d2ca1a0a0d677a3eaca23edeb07b74e652a0bc50c6c083a55d6c7306e74086f4768933aa24873681867a7893d77cb7f29b8c847c583f2d071a686616e206719f761ae39c110442e06163d2b84590360695d4e19849e634f24d9ad396c19ff83ce74f46e645f932e141a41195936c85d514414f112e60b1a2537c38d6dc6c4638305c9bd6c62e366bc63123e3e6dd36eedd3136fce8deeca2aa09a3298a39d83859efc9b2b69cf9a7dee08a98e4be558ac7912fdcb42209075420260f7cad0f2c01f2afe33073f26249d944f7a50dd84839bc3ea7fdee4ed71449cf07533d26e1e27a3efb032c3a3b34bd3092622d2062ae536ef5149c49b5bc9475eafab6e675761008b0daddeecaa604470bbe0fada255d290e92b190c2c2d8c2dee5455d1fa9a9f3db7779b584643464aa8014ba66994de25517f83980e66ee4f62314ae6dbef452d5d38b0a16f3991f36d8a8b39ddc0d5595eed98762878cdf3f4a2edc5cda77d5fe4faf63a15f568a540da57dd9beb6fb1a977ccb91b4d79cb39b28911a29e7bf028ac6103796dfb6b20967239ad373c3c51d3927f2380019fbdbdde59697322636a0aea1fd22c588575c0f89649e9f3ed393cccabba2e794b7c4b2daf8ddeb7f45270d3f95edba5b0de7a32819233b0c55350114ccbc481586fd0542c3a0afdd245228ac7474b3f549b103a0062df1bdae35be3f6a92dad6177cb848eee24c8520a330bdfb26d75fe7b4b365d094451222eae18b9849f5aa17e52ca5c71e844075cd44038e5c894ca2cd19765cf8f61b619af02456ae695962fe5e931a63b5c79052ecd333e18412db91e15f7cbc70b4cd7e8e3c951f358572e37767e7d52704a6721b30efc41017ae4d231558c5c82cc7dd7e3356c09dc24906f0438dfcc300856ac2ced8f77fa8015736c661e80248aeeb774874aa79d290b8f5027a0a509537fc7c689b7ad86116cfec2647ccaae1c74b416f3e6ae8f7cc60eaaf7b6a590d51544138e1732945603a53462c60e1f6cb0c9ca0390c488224c313269fcd59fcb611fb2d9b4c8fa601bb1cb8d07d797bf5de52bceeb02301c8962ac1fc0491dc81affd6c1ebf89a13d6f290eda5d5cef382215c5e951d71305ef33d9737126d0e662905f1250926f6a229990e38f69ad9a9192b302f26bdda465d90b94b12c57fa3fd6930083f184438d8a889d3f5ecea2c6d23d6736f2a0f18e26f4fa45d1be8f3dc4a707137e95d2ad594f6c03d24923067ae47fd6425efb9c1d504e6fd5575340945601fe806f5756acb562f13c0ca1d803a195c2ebb2ef02ac33e6a88dea075ba996d3c336648e8694d3a19d3dca531beb50d4327c5c0c23cb7cfdb08ca7cf2cac6bc139d0741473d376029cb4ab6bf054557ce294c728a4687d57ec8909ff51a4d02f9dcd11193d7d1c9fdae6a17396a1bf57a994934f5e7a59f045debeaff62ef326b947f2a8b49555e4d99b3bf5c81ff9fe314e047af152508f57015ca402c67d925c99acea3ee8cc4b008c5cb43966e714ef480fd05e07c7b2dda9aa3966113eaa293d3f622b309d64803ce1e6378b6aac4fab527c43cd45ed0a3c1a4b9fb18dcccfcdb6ac0c2421639cda0075a20dc5111b8d3d3199495bd9133dbab94541410e4fba92c7b606a5cb122f140cf1a3596f2788f3c8b92660f14cb65af5dd23dfdbac1371ecf4b33712fed2292c44f70834cf96c05d58827e69bfc2e696fa0874025e2c3d19b072020031513b1962ec540856cb189387cfbfcc0f7c68223cba47fb0c9b486e4d99171961f7675a8b46328a3bc109bf07c66d5ede771cc4c74ce80333829191eedc493508a644530a6144f22dcf97525a4cdca1ad71073b080b73ea4549f5401bff4318268e6ad637363157a19a53f123a0b0e16d0b77f02028da464100fde76d83dd0bb224ede28042290ab2bce854139bca36e5b2cbdfdd9106fc9f18b95553e4fe548b3e4a87daa7ef1ee38ee9b4e0dcd63e80ecbba7e74b3e3ba3d0e8a6392a062b8e065a54414c3c5bd9ce4e85ca6293e884d1456a4c31e1654ff23ef26e2e14e1298a49c072e22f9d98bb0f9b03bd5fd013fcef3ed6a49aeb98720254087ef728e319db964cea54d0eca76cfe56288b6f64f4a19df37ed17be812e82d7d40536f378a931c82cf7111d6e117809363809b6be378f8fd5a1ce22a8d3c4547abd959830aaaf013de2bf27a1fbae8b16f38d1349b6031ce02348a240579c0e535790458b4963b616933d1005c1d03d4c95180c8d17a55ef4bee465668b20ea4118ca5692e", "6762f9c57230a58dca6d444547b2f6e0e213492dbb40564ae101df13941c6152", "1c3ec5104d96b66837b6e381f702c7e48a097aaf125c9b82895b578b92eafd14", [787459282010655, 1685382316228727, 1715663111103469], ["656a", "650051526a", "526a5153005152516a"], 2, "a7e272ca044087c4d35661888b348c57e98b7981a16fe5e88181c8e15aae581c", "da3edd81f4fa79e47fb676ca0b56b1299ff5b5ec5823ec871e3d7c12884fe577", "dde86c6961d02d655103c9d19c89623fde4ec6b5282bb8fbc7e8ba46911e9a3e", null, "411508bb7b2194f617adc6c782bb7720c8dfc25fef3bc48ec731a24aa2c1c105", "b4253a25bf7ee6cd209c5f07666fea853e4b800862a29aa5a8961f953203a3b0", null],
    ["050000800a27a726b4d0d6c281836c3be99a081703a460e968aa7109870bbed17df5f888c8ca1467ae17dbbcde31c1105cb5bda88ac6c627000452ac52ac0ffe81ec58bf1e6d1bb7aaada41fba0bb588778a7f65202ad811ea73d26c74550395aff75325107c096a5251acac00650051a2e7424719a3d185b7e0a43a472e298ac0afdc5287d7ad124cd9405a62cd1ca08b282efef7f928df0852525251ac5353aceaa5ff1200000000", "221d40597b563f206458f9736b8549237c5554242c419022435a3350a0708ea1", "6a75e49324e85320fe2f22466618b70b4bbefea248e5d3673f18f2e487a2b20a", [1076763594431866, 316847576141144, 1780844721475339], ["006551ac65630053", "63520053", "acac00656a6351"], 2, "b5a18ff657839c6979c2f2afaeeaf2f5c1cf43df92f4a65755fa42ae2b7706ab", "9d802c8ace5bc5f5b03c7dac8a29ef33424def82cbc4fc8400c0bb9d5e084147", "ae2db14c57781fb55c2f6658f6141883f7ebe0d39f439cf566dc550fb9da7168", null, "e711834b5a4eb84aa2986a53c2b2ba2fd6374e666f0311bfca8cbceefdde1e38", "5c3a0839fdc73417ae7d5f15dceed6c1a4cbe80c6c25ce0386fef7c058a8b943", null],
    ["050000800a27a726b4d0d6c257b85751235dbc100252e41e002931b45746198e5dd9571a56a7e0d423ff27989d3eb417ecd3c3093fb82c5658009624c53219a60cd0a8c4da367e29a71779a73032985a3d1fd03dd4d06e05566f3b84367cf0faee9b0963525200526a53acac5d82d0a602efabecef1bc70100020063977663550e760600016a00000309a89a5f40b37303e1816df13a9d7e20db159c9f42773a2fb023d95abb1e1cbe81c092edb230fa38ea13c5de7c0e5031a1e84daec3ebe62d5f6c4abe5ce90a3fcdc3a6500c011c8a0fc03db6cc0c56cfd6543aed33ac6b7c4db783dee6b329277f96c7e90bb9b47302465f375c1d3ca48e54facae0f9c2dd4d64d9046152b43634227fbe32f663bd1d90bbfa22f0e9c793477193ddcb40181a679eae7811323231f01f55c7ad04cfb63f7c4a3d0a2b0ffb0b05a6be055b8c94ca80bb0a1d13cd4cd69ab98304ae2515d5f7699d4abee5c20be609d873511012f234bd85a7eff5fb634cff2658ba6516048563095ecefb3015ee3f03ca52a177f261ecdc26bc089d34c6404846e9c647fcfe98cc6acdbb464f64278ad8ce9d1ae0d415bc0c05245fddaf4ebc8dc703a85cb270f796ad2d937e2ac0d5e0a34821758000aa59c9d4652485294ee0ab29696b21430fa54dcfbf2b9c49d142064209eeeed4d471ffc017d4e20a796b0927804c061b9f4a7091fe015ada68fd8442e01825c88dfe55cf5de38936f7ce25311b902ba97a3c12a95cfa1c3a591b818f60832709d9e4839e410fb36b84f3ac4f070fc35e161978259e5b8edc744d90919aa770bb36215128e582b59641e23852e958eb8fc3c0aa96152ba4f77f138d6a6712a3ae3226015883f81db23e583c869c4c71143a6fffd65e8dfdc50c99a2f1f314cdcc71359e235f1d7dc2b5f38ef7b970843163c03f9dd40a8015efdc8791956a3f3cedd9ea64f8efa7a0815a70381d71467817bd04ca529aede07ff60d176aed0f855a2eaea89eaeaca89358c081826a0812a5bca28be1373f086dbdba7e43e203212c9fed21474ba19a055ffcc179412e893a744832298c5fe24cc6b18667f49b34dfb12379267419a9cb9403d8167d8d1e91d2811a043b29243b069b37587847dc6fcddb1831bd1cc2567ca033ac40f74ab6955f683b12e4e8254e4ea760d38b3f46791c5c4cb12bc7ccb0ed1865f25d601c303f81fb1fa1db48533d3d6b288e4d9a4dff8ec21c96f578399710c825fe7e32f93a8c0743f9ebd54cc151c7610337aebf7e9b915720a54351d49ab8c22fa34998dcf583d4387361ef3ff86f50ec53f49249e4ad349603066fc9c661d69f911dfa7241c8d5792d78332e93db6593e593fd5d456abdac79a716fa6e3f3928a84d197086ecc27eac188ff2b71521762ad47bec08992d86850eb3ea13d5070807a2cb6680a249ea1c04203748daab9b0d3b3c2e9dcfe7760c79dda3c0259e7da9ccfa5fb647a5e20f3f3bc866da24eade36b683a2bd7197fb672726f42008b46ad7f8abdb18117f322c57dc017b0a371f4863135b4db5a1b6e0111e630e23459a748833991cff71a05c4ab19dd99771582d038104b7e039a376f7acbbeadb34f945beb9d7ca0e4e3d5c5e4eb1d8526ebd13dacb1ba35735c6d04a4555acf4bf117626500d77b38189dd4888041225acbe3874a4c0f607fe6745f9355b3fa188f1d65c09f389af1b9d6232aa79447919c550f6f31fec35481cb922de2db5b4da2f81948617028e321706a3a778c1938c443bb00e5b0ff06ad8ab9b1ab0c11477673f85df9561dbea45d5f9781ebe317a0710ae5461e34fe6f1b1aa9b4e67b14910984802c2a7e38193bc7bdc8ba3e4e3d1d933bfb580f5b3e87a2a06517051410fe1b4ff1ea0ade824f338515456a57c7a916a74388ee8f1281f9ade0ae2a2613a0612c469df792b8df4cae4fc25c1cadba95a807ce61e5a5303faaf9e14653996b5a8adc34fd475ef1499094babaf1f3f07da9a390b1d9fc9a08327987adfe9564863fbdfa8f6b46a8841583099afb7870118face76347e40b6fd8cd15582ae8e23be9a0219bc3e4e4546a30d3bbbbd1686086876be0e4c859be71fb58f4fab3d28c0b4f7e75ad1edb7f88946fb40cfa5786a0fcba1303c8347ecee93d46d140bb5f69531d666548b109ce764bead7c87bd4c876494de82db6e5073a6c94f7c099a40d7a31c4a04b69c9fccf3c7dd56f5544776c53b4df7953981d55a96a6dcff9904a90842e5bafec8840c2d255bf5ad61c460f98feb82a10fa1c099f62776798236c5ca7f1e46ebdb2b144d8713e56c772f2c3b860ea5b03a8854bc6e6590d63cc0ea54f10b73ba241bf74b635551a2aaca9687ac5269fd368b26d70a737f267685998a3f7d2637914909c746495d24c498635ef97ac66a400894c09f73488eb7cf33f6dad1666a05f91ad7757965c29936e7fa48d77e89ee0962f58c051d11d055fce204a562de68088a1b2648b8174cbcfc8b5b5cd077115afde1783f5cdb26f7bfdf87b21b1c70dc56bf1c82857a40ca2aa236ec566912d864937aa07ddffcd377395cba616d63c0b69c01fcc45391fd5b8763fb96d7ca333a127911b4ed95b00c24cb578ffab9f1116030048608cc990e74ebad5c348ad9a885e907e0be5a7883c88489cb41432dac862023d46789eb7d989af779e5b8d28305d7e2124d3b55770f8c050ab25e1a4602eb58cf1234eae15f33bbdece27a6b12db3e4dbfd3a2bfcc9ee6ed016c0f665be8133b7dc1d86044db0f9db40fb0e9f8bc2e4db5382a8b4f815b4e8434ad0dfbc51a5e9b145e1596cbf4670b7e05dfdafbb0cf3ddee28d76a82428e8aba4364e84bac379298df2932e69bb5d045516efc33ae6cc3947ceb09ed371667212a831b5485eafce8488188ea4e27d0cdf7ddd348abff777f4a13bbc716b6a5944ee727965690e209b49eb962c039975f939ed5c6e4c400d887759433d3ad716da0cb446113c7727a64b58c3f8a0f81189f98005233a81366aee73cec85228ebcfd5ee3c3fb44db76ba243f2842b7b5fc746ae51b0bc4bd4fc9fd833565ea852b92b224f6990318ad8c7d9437e20e2a1f20e818f9057c5abaaa2e5c15b94945cd424c28a5fa385dadfe4907b274d842707db3697a5ae6c8f542e5ecc07fe47350d1014670212efe81fb7c73e8450df814ef6232f7490f63ccf07480f884a66eaffc28fea448d7b401cdae10e7c0c7f9a7b15331969fc8cb36396773de191931c750f6ce5caaf29768ebb27dacc738056a8125b4772bf87ae10a8a309b9bd655043cfc3159494368c5ab8cadb7f671e9626bd263e31181a604b506a03b439a7ffe4355892477e2bdf338c62c3922f7d3c9a56c7103d911948a84b5ae2dbb16a3761add053a0f967e6b5bc94211b6547153267c6ee1cad0d974a71088583735e4f63d33156dadd54c2faf89114a127b97b94cc2a22ef303f459d04fc0b53ace5918d47ff33a558bd71a75f355fbd06bbccf4e02c3c0a4b63d0cc949801d63a64cb2d32373b2c7b274ab2db4682142c8b21d84c481f5ef21e4b5e3603451bf94774d0ef47f63fa6abb78d21c193cbe65b695fe67423c1e2d312e2776fa24ece84683e74876c55ea0369e4ea0e86494e00dde236a1689731f0a5d8203afde5c423640b81e4f631c981c03839f4b44c9e8030023f8b9d8178560daf975111955a2bca3423eeefc527be3a8543eb90a5ec02f35c7c64b7dd59a72da0074634e01d2abf3637add77c7350f12b011b294168ec75576e47d169e3938bf6ae2aa8ff7cfba7cacb1f92b6e4c2497bffa9f17cad242fa9c3179c1a3aa81f7361649572c715c25a1f6cd5ace82c00ab2342b9c3cb4fffdda160ca5ab9e9baf2139ef9afbe1b1f309462afce462a79bb9698e22c957c590a753a76b87e009121e06f6a1bf62a08bf435d92e2fffe86e2a9cbba9133a68e4aebf33c38436f2545fc2d52832d165af415b244adc5f57377deedf460aa3beb43419c6b082e835cee2f16f2f8767f03d9f42a84a76cb6867b2bc75baeeccafe61519cfceac5527961b324dce09335a5853a6b4da3e471fc1fb196f76d9b879c7200862ead18dea1f3ec9037f37b6ea289166510b475b20044d452e0f6ec3ab47161507d53a2dc60949f1e450c3eadaef886e6b827c5bb5ef11f4028a704fc5a9382c6b03e7d8081e07989286a0d9ce561faa1b6e9623d7ab71007fd277b986a048834602eaf8780f0675baae68415d3af01019b5ea480dce9362ec8d5df3e780ffa72eba8a8df73c540870a839bb03910a491770e1c84b223ee9165270c4ccf6fc7075c37e6fbb14381507fa18f13953336ab2bedc600c615bd49927e9d7f4884e6ed3fd5e4b7c38", "5bb44ebf8030ac2fb74d82b432d480218a3d1648e3270b89ffb3cf735c2ce7a0", "b3d8ef975a6afa7200923c1160b7ebcfce43b5b91ee3b3dd91784938bfa68ea6", [1399781968202734, 1999413718097392], ["005300", "535152526552005363"], 1, "a81923458121cdb56475f96ed2d92080f56ed306e41f45012af57cfb348acda1", "0b752de948552d1170c1c9382db14eb46ada2db164da90141a626a035df3b4d5", "ef8af06f6aec49394f466ddd5a6c112f80ded7687ca21c10782fda261be5f687", "9ba54ff9f5da79fba51cdf4891c021d8dbe888bf215f7c2fd79e43ba5dd1cc76", "2254839a4ed25a96548dd804dc333829baa4da2677e9c83df8ab2d5a57cd666a", "1497bf31df9b0f6e77e1173a9eb408ef5e19d844aa9a85b6e7546f30de1f0be2", "39acb5fd91a12dd40736fc6aba53fdf52f05838094c3aa6ef345d94a1a0724bf"]
]

AUXILIARY_SAPLING_DIGESTS = map(unhexlify, [
    "4ae5dd1bfb8c15bc3de59ab71530912abe24059b10665722f3fb8fae9b55006c",
    "8928246ab2688c651481df538caae0c9df113665f03947ef24eac26744be4ff4",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
    "fb05fc3237bae8aaaa3f0f1da344c8a2f2e7245acd8fc22ec36bb8afead4c980",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
    "6f2fc8f98feafd94e74a0df4bed74391ee0b5a69945e4ced8ca8a095206f00ae",
])

class MockSaplingHasher:
    def __init__(self, digest):
        self.digest = lambda: digest


@unittest.skipUnless(not utils.BITCOIN_ONLY, "altcoin")
class TestZcashSigHasher(unittest.TestCase):
    def test_zcash_zip244_hasher(self):
        """
        Test ZcashHasher on official Zcash test vectors.
        Digests of Sapling bundles are precomputed externally,
        because we don't implement this part of the ZIP.
        Coinbase transactions pass too due to some dirty tricks.
        """
        for tv, aux in zip(zcash_parse(ZCASH_TEST_VECTORS), AUXILIARY_SAPLING_DIGESTS):
            tx = parse_tx(Reader(tv.tx))

            is_coinbase = len(tx["transparent"]["inputs"]) != len(tv.script_pubkeys)
            t_inputs = tx["transparent"]["inputs"]
            for txi, amount in zip(t_inputs, tv.amounts):
                txi.amount = amount
                # Trezor requires reversed hash
                txi.prev_hash = bytes(reversed(txi.prev_hash))
            if is_coinbase:
                # script_pubkeys_digest is never used for coinbase
                # this is just a mock script_pubkey
                t_inputs[0].script_pubkey = b""
            else:
                for txi, spk in zip(t_inputs, tv.script_pubkeys):
                    txi.script_pubkey = unhexlify(spk)

            t_outputs = tx["transparent"]["outputs"]

            header = tx["header"]
            assert header["version"] == 5
            sign_tx = SignTx(
                coin_name="Zcash",
                version=header["version"],
                version_group_id=header["nVersionGroupId"],
                branch_id=header["nConsensusBranchId"],
                lock_time=header["lock_time"],
                expiry=header["nExpiryHeight"],
                inputs_count=len(t_inputs),
                outputs_count=len(t_outputs),
            )

            hasher = ZcashHasher(sign_tx)
            hasher.sapling = MockSaplingHasher(aux)

            for txi in t_inputs:
                hasher.add_input(txi, txi.script_pubkey)
            for txo in t_outputs:
                hasher.add_output(txo, txo.script_pubkey)
            if is_coinbase:
                # force SigHasher to use `T.2` instead of `S.2`
                hasher.transparent.has_inputs = False
                hasher.transparent.has_outputs = True

            if tx["orchard"]["nActionsOrchard"] > 0:
                for action in tx["orchard"]["actions"]:
                    hasher.orchard.add_action(action)
                hasher.orchard.finalize(
                    tx["orchard"]["flags"][0],
                    tx["orchard"]["balance"],
                    tx["orchard"]["anchor"],
                )

            # test txid computation
            self.assertEqual(hasher.txid_digest(), tv.txid)

            # test sighash computation for a shielded inputs
            self.assertEqual(hasher.signature_digest(), tv.sighash_shielded)

            if tv.transparent_input is not None:
                # test sighash computation for a transparent input
                if is_coinbase:
                    computed_sighash = hasher.signature_digest()
                else:
                    target_txi = t_inputs[tv.transparent_input]
                    computed_sighash = hasher.signature_digest(
                        target_txi, target_txi.script_pubkey
                    )
                self.assertEqual(computed_sighash, tv.sighash_all)

    def test_zcash_hasher_transarent(self):
        # this test vector was generated using
        # https://github.com/zcash-hackworks/zcash-test-vectors
        tx = SignTx(
            coin_name="Zcash",
            version=5,
            version_group_id=648488714,
            branch_id=928093729,
            lock_time=2591264634,
            expiry=36466477,
            inputs_count=3,
            outputs_count=3,
        )
        inputs = [
            TxInput(
                prev_hash=unhexlify("4f61d91843ccb386dd1c482169eef62efaaf9d9364b1666e4d4c299e04a852e1"),
                prev_index=1569726664,
                multisig=None,
                amount=1249971475008092,
                script_type=InputScriptType.SPENDADDRESS,
                sequence=0x8849f2a3,
                script_pubkey=unhexlify("76a9149466817faf329208fc3c3ef42ce4513d22fc1f9b88ac"),
            ),
            TxInput(
                prev_hash=unhexlify("368e9c7e1fe01f6c54db9379a94c2941ef180c25b869bf8dcdb1cf014253b3c7"),
                prev_index=2648876502,
                multisig=None,
                amount=1353789347081201,
                script_type=InputScriptType.SPENDADDRESS,
                sequence=0x8a37691c,
                script_pubkey=unhexlify("76a9142275979f97043edd9a6083ee27d136727ce5f42888ac"),
            ),
            TxInput(
                prev_hash=unhexlify("f5621d6ad566c13dce81632a9168694bb6bcec2f7bfac2626f9425e1640fe4f1"),
                prev_index=492165032,
                multisig=None,
                amount=1672802384749611,
                script_type=InputScriptType.SPENDADDRESS,
                sequence=0x6a993d20,
                script_pubkey=unhexlify("76a914682c89bfc3940621bd4a4bfc349a79b46ce707e388ac"),
            ),
        ]
        outputs = [
            PrevOutput(
                amount=865034086766210,
                script_pubkey=unhexlify("76a9140d06a745f44ab023752cb5b406ed8985e18130ab88ac"),
            ),
            PrevOutput(
                amount=2088955338922857,
                script_pubkey=unhexlify("76a91463ccb8f676495c222f7fba1e31defa3d5a57efc288ac"),
            ),
            PrevOutput(
                amount=1760123755646275,
                script_pubkey=unhexlify("76a914fb1a38e01d94903d3c3e0ad3360c1d3710acd20b88ac"),
            ),
        ]
        pubkeys = [
            unhexlify("02ed9c769c787fda78a7da13764707d14217e74e26428b47a2a8fe6d5a0bc46196"),
            unhexlify("0219ac5de9a45f76e7efede5259acd94bb047ab8e7cc60fe844cb32317072ebbf3"),
            unhexlify("02829099a7cf1f617c956c0222e7b77ae331813d6a736eab3c5f6344d961843d39"),
        ]
        expected_txid = unhexlify("c91d34ecc44484b07ee573f385d80e57e4e57571bb86aa6ec6c44d654123e4e9")
        expected_sighashes = [
            unhexlify("4d82669c8c0e9b1f26d59bcb347212f2d044eeb839fce21e039d8bb082bbc343"),
            unhexlify("2e2a27d78d117e28760d3c972f9614547ec57688c970f06c19c515cded6b030c"),
            unhexlify("d0a92ffd4a4d262f5b84598bcfca741a42c17b8e9d26cf4fd87839df8f33e4ee"),
        ]

        hasher = ZcashHasher(tx)
        for txi in inputs:
            hasher.add_input(txi, txi.script_pubkey)
        for txo in outputs:
            hasher.add_output(txo, txo.script_pubkey)

        # test ZcashSigHasher.txid_digest
        computed_txid = hasher.txid_digest()
        self.assertEqual(computed_txid, expected_txid)

        # test ZcashSigHasher.signature_digest
        for txi, expected_sighash, pk in zip(inputs, expected_sighashes, pubkeys):
            computed_sighash = hasher.signature_digest(
                txi, txi.script_pubkey
            )
            self.assertEqual(computed_sighash, expected_sighash)

class Reader:
    def __init__(self, data):
        self.data = data
        self.index = 0

    def remaining(self):
        return len(self.data) - self.index

    def get(self, n):
        result = self.data[self.index:self.index+n]
        self.index += n
        return result

    def compact(self):
        b0 = self.get(1)[0]
        if b0 < 253:
            return b0
        elif b0 == 253:
            return int.from_bytes(self.get(2), "little")
        elif b0 == 254:
            return int.from_bytes(self.get(4), "little")
        elif b0 == 255:
            return int.from_bytes(self.get(8), "little")

    def uint32(self):
        return int.from_bytes(self.get(4), "little")

    def uint64(self):
        return int.from_bytes(self.get(8), "little")

    def sint64(self):
        return int.from_bytes(self.get(8), "little", True)

def parse_tx(r):
    return dict([
        ("header", parse_header(r)),
        ("transparent", parse_transparent(r)),
        ("sapling", parse_sapling(r)),
        ("orchard", parse_orchard(r)),
    ])

def parse_header(r):
    return dict([
        ("version", r.uint32() ^ (1<<31)),
        ("nVersionGroupId", r.uint32()),
        ("nConsensusBranchId", r.uint32()),
        ("lock_time", r.uint32()),
        ("nExpiryHeight", r.uint32()),
    ])

def parse_transparent(r):
    w = dict()
    nvin = r.compact()
    w["inputs"] = [parse_t_input(r) for _ in range(nvin)]
    nvout = r.compact()
    w["outputs"] = [parse_t_output(r) for _ in range(nvout)]
    return w

def parse_script(r):
    script_len = r.compact()
    return r.get(script_len)

def parse_t_input(r):
    return TxInput(
        prev_hash=r.get(32),
        prev_index=r.uint32(),
        multisig=None,
        amount=0,  # amout unknown
        script_type=InputScriptType.SPENDADDRESS,
        sequence=(parse_script(r), r.uint32())[1],
        #script_pubkey=unhexlify("76a914682c89bfc3940621bd4a4bfc349a79b46ce707e388ac"),
    )

def parse_t_output(r):
    return PrevOutput(
        amount=r.uint64(),
        script_pubkey=parse_script(r),
    )

def parse_sapling(r):
    nSpendsSapling = r.compact()
    vSpendsSapling = r.get(96 * nSpendsSapling)
    nOutputsSapling = r.compact()
    vOutputsSapling = r.get(756 * nOutputsSapling)
    if nSpendsSapling + nOutputsSapling > 0:
        valueBalanceSapling = r.uint64()
    if nSpendsSapling > 0:
        anchorSapling = r.get(32)
    vSpendProofsSapling = r.get(192 * nSpendsSapling)
    vSpendAuthSigsSapling = r.get(64 * nSpendsSapling)
    vOutputProofsSapling = r.get(192 * nOutputsSapling)
    if nSpendsSapling + nOutputsSapling > 0:
        bindingSigSapling = r.get(64)
    return dict([
        ("nSpendsSapling", nSpendsSapling),
        ("nOutputsSapling", nOutputsSapling),
    ])

def parse_orchard(r):
    nActionsOrchard = r.compact()
    if nActionsOrchard == 0:
        return {"nActionsOrchard": nActionsOrchard}
    actions = [parse_action(r) for _ in range(nActionsOrchard)]
    flags = r.get(1)
    balance = r.sint64()
    anchor = r.get(32)
    sizeProof = r.compact()
    proof = r.get(sizeProof)
    return dict([
        ("nActionsOrchard", nActionsOrchard),
        ("actions", actions),
        ("flags", flags),
        ("balance", balance),
        ("anchor", anchor),
        ("sizeProof", sizeProof),
        ("proof", proof),
        ("vSpendAuthSigsOrchard", [r.get(64) for _ in range(nActionsOrchard)]),
        ("bindingSigOrchard", r.get(64)),
    ])

def parse_action(r):
    return Action(
        cv = r.get(32),
        nf = r.get(32),
        rk = r.get(32),
        cmx = r.get(32),
        encrypted_note = TransmittedNoteCiphertext(
            epk_bytes = r.get(32),
            enc_ciphertext = r.get(580),
            out_ciphertext = r.get(80),
        )
    )

if __name__ == "__main__":
    unittest.main()
